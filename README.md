# ECOマネからの情報取得のための Sensor Component ecomane
Panasonic の ECOマネシステム (電気・ガス・水 計測タイプ)のWebから電気、ガス、水の使用量および回路別電力のデータを Home Assistant に取り込むための custom sensor component

次のURLのブログ「Home Assistant のECOマネシステム用 Custom Component」に少し説明を加えている。
http://kunsen.net/2024/10/27/post-5280/

## ECOマネシステム
ECOマネシステム(生産中止品)については以下のWebから情報を得ることができる。
https://www2.panasonic.biz/jp/densetsu/ems/eco_m/

### 困った点
* 通信遮断
ブロードキャストなどで受信パケットが多いと、ネットワーク通信が遮断され、しばらく通信できなくなる謎仕様である。
2024年時点の感覚では全くトラフィックが多いと思われない場合でも15分くらいに1回程度遮断が発生する。

* 同一セグメントとしか通信できない
192.168.1.220/24 などのIPアドレスを ECOマネシステムに与えている場合には、同一セグメント 192.168.1.0/24 としか通信できない。
Webのrequest が届いても response を他のセグメントに送ることができないようだ。

## 機能
### 省エネモニター (電気、ガス、水の使用量)
ecoTopMoni.cgi で表示される以下の情報を取得

* 太陽光発電量
* 売電量
* 購入電気量
* ガス消費量
* 水消費量
* CO2排出量
* CO2削減量

### 回路別電気使用量
elecCheck_6000.cgi で表示される各回路の電力を取得

### 回路別電力量
resultGraphDiv_4242.cgi で表示される各回路の今日の電力量を取得

## 環境に応じて修正すべき点
電気回路の名称関連を環境に応じて修正する必要がある。
ECOマネの表示では日本語を利用しているが、日本語をそのまま利用すると漢字が中国語読みに変換され、entity_id などが何を表しているかわからなくなる。
そこで、ECOマネの日本語を英単語を基本とした entity_id に変換し、それを利用するようにしている。
この変換に利用している name_to_id.py を修正する必要がある。

Home Assistant での表示は、translation_keyを利用して日本語に変換している。
この言語の変換は、translation/ja.json などを修正する必要がある。英語表示をする場合には、strings.json や translation/en.json を修正する必要がある。
